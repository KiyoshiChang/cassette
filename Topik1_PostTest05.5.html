<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOPIK I 듣기 후측</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        
        .cute-shadow {
            box-shadow: 0 8px 32px rgba(0, 150, 255, 0.2);
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }
        
        .hover-scale {
            transition: all 0.3s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
            cursor: pointer;
        }
        
        .countdown-number {
            font-size: 4rem;
            font-weight: 900;
            animation: scaleDown 1s ease-in-out;
            opacity: 0.6;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.8), 0 0 40px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            position: relative;
        }
        
        @keyframes scaleDown {
            0% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f39c12;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .audio-player {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 20px;
            padding: 20px;
            color: white;
        }
        
        .subtitle-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 2px 15px;
            min-height: 35px;
            backdrop-filter: blur(10px);
        }
        
        .option-image {
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            pointer-events: auto;
        }
        
        .option-image:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }
        
        .nav-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-button:hover {
            transform: scale(1.1);
        }
        
        .nav-button.current {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }
        
        .nav-button.unanswered { background-color: #9ca3af; }
        .nav-button.correct { background-color: #10b981; }
        .nav-button.wrong { background-color: #ef4444; }
        .nav-button.timeout { background-color: #8b5cf6; }
        
        .feedback-message {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        
        .overflow-menu {
            position: relative;
            display: inline-block;
        }
        
        .overflow-panel {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            padding: 6px;
            min-width: 150px;
            z-index: 1000;
            margin-bottom: 5px;
        }
        
        .speed-control, .subtitle-toggle {
            display: block;
            width: 100%;
            padding: 4px 12px;
            margin: 1px 0;
            border: none;
            border-radius: 5px;
            background: #d1d5db;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            height: 28px;
        }
        
        .speed-control:hover, .subtitle-toggle:hover {
            background: #e5e7eb;
        }
        
        .speed-control.active {
            background: #3b82f6;
            color: white;
        }
        
        .subtitle-toggle.active {
            background: #10b981;
            color: white;
        }
        
        .close-button {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ef4444;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1001;
        }
        
        .close-button:hover {
            background: #dc2626;
        }
    </style>
</head>
<body>
    <!-- Page 1: Home -->
    <div id="page1" class="w-full h-screen flex flex-col items-center justify-center p-4">
        <div class="text-center mb-8" style="position: absolute; top: 0.5vh;">
            <h1 class="text-4xl md:text-6xl font-black text-blue-800 mb-1">
                TOPIK I(한국어능력시험 I)-듣기 후측
            </h1>
            <p class="text-2xl md:text-4xl font-bold text-blue-600" style="margin-top: 4px;">
                (by Kiyoshi Chang)
            </p>
        </div>
        
        <div class="flex items-center justify-center gap-8 mb-16">
            <img src="https://mon-ami.up.seesaa.net/topik/TOPIK_Logo.png" 
                 alt="TOPIK Logo" 
                 class="h-24 md:h-32 object-contain"
                 onerror="this.style.display='none';">
            <dotlottie-player 
                src="https://lottie.host/7ed854b3-9684-40f1-b6fd-810ce0c67921/rbhEC1S0dd.lottie" 
                background="transparent" 
                speed="1" 
                style="width: 200px; height: 200px;" 
                loop 
                autoplay>
            </dotlottie-player>
        </div>
        
        <button id="startQuiz" 
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-12 rounded-full text-xl cute-shadow hover-scale"
                style="position: absolute; top: 88.06vh;">
            TOPIK I-듣기 QUIZ
        </button>
    </div>

    <!-- Page 2: Quiz -->
    <div id="page2" class="w-full h-screen hidden p-4">
        <!-- Title -->
        <h1 class="text-3xl md:text-5xl font-black text-blue-800 text-center"
            style="position: absolute; top: 0.5vh; left: 50%; transform: translateX(-50%);">
            TOPIK I-듣기 QUIZ
        </h1>
        
        <!-- Status Bar -->
        <div class="flex justify-center gap-2 md:gap-4 text-xs md:text-base flex-wrap"
             style="position: absolute; top: 8.61vh; left: 50%; transform: translateX(-50%); width: 95%; max-width: 900px;">
            <div class="bg-white bg-opacity-80 px-2 md:px-4 py-1 md:py-2 rounded-lg cute-shadow">
                <span class="font-bold text-blue-800">문제: </span>
                <span id="currentQuestion">1</span> / <span id="totalQuestions">18</span>
            </div>
            <div class="bg-white bg-opacity-80 px-2 md:px-4 py-1 md:py-2 rounded-lg cute-shadow">
                <span class="font-bold text-green-600">맞은 문제: </span>
                <span id="correctCount">0</span>
            </div>
            <div class="bg-white bg-opacity-80 px-2 md:px-4 py-1 md:py-2 rounded-lg cute-shadow">
                <span class="font-bold text-purple-600">점수: </span>
                <span id="currentScore">0</span>
            </div>
            <button id="homeBtn" 
                    class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-1 md:py-2 px-4 md:px-8 rounded-lg cute-shadow hover-scale">
                HOME
            </button>
        </div>
        
        <!-- Audio Player -->
        <div class="audio-player cute-shadow"
             style="position: absolute; top: 13.43vh; left: 50%; transform: translateX(-50%); width: 80%; max-width: 600px;">
            <div class="flex items-center justify-between">
                <button id="playPauseBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-3">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path id="playIcon" d="M8 5v10l8-5-8-5z"/>
                        <path id="pauseIcon" d="M6 4h2v12H6V4zm6 0h2v12h-2V4z" style="display: none;"/>
                    </svg>
                </button>
                
                <div class="flex-1 mx-4">
                    <div class="bg-white bg-opacity-20 rounded-full h-2">
                        <div id="progressBar" class="bg-white rounded-full h-2 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-xs mt-1">
                        <span id="currentTime">0:00</span>
                        <span id="totalTime">0:00</span>
                    </div>
                </div>
                
                <div class="flex items-center gap-2">
                    <input type="range" id="volumeSlider" min="0" max="100" value="100" 
                           class="w-16 h-2 bg-white bg-opacity-20 rounded-lg">
                    
                    <div class="overflow-menu">
                        <button id="overflowBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
                            </svg>
                        </button>
                        <div id="overflowPanel" class="overflow-panel hidden">
                            <button id="closeOverflowBtn" class="close-button">×</button>
                            <button class="speed-control" data-speed="0.75">Speed: 0.75x</button>
                            <button class="speed-control" data-speed="1.25">Speed: 1.25x</button>
                            <button id="subtitleToggle" class="subtitle-toggle">Captions</button>
                        </div>
                    </div>
                </div>
            </div>
            <audio id="audioPlayer" preload="metadata">
                <track kind="subtitles" srclang="ko" label="Korean (한국어)" default>
            </audio>
        </div>
        
        <!-- Subtitle Box -->
        <div id="subtitleBox" class="subtitle-box text-center"
             style="position: absolute; top: 25vh; left: 50%; transform: translateX(-50%); width: 80%; max-width: 600px;">
            <div id="subtitleText" class="text-transparent select-none">
                <div class="font-bold text-lg">한국어 자막</div>
                <div class="text-base mt-1">中文字幕</div>
            </div>
        </div>
        
        <!-- Countdown Display -->
        <div id="countdownDisplay" class="text-center"
             style="position: absolute; top: 46.5vh; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
        </div>
        
        <!-- Feedback Message -->
        <div id="feedbackMessage" class="feedback-message hidden"
             style="position: absolute; top: 46.5vh; left: 50%; transform: translate(-50%, -50%); z-index: 100;">
        </div>
        
        <!-- Option Images -->
        <div class="grid grid-cols-2 gap-4 md:gap-4"
             style="position: absolute; top: 32vh; left: 50%; transform: translateX(-50%); width: 90%; max-width: 800px;">
            <img id="option0" class="option-image w-full h-auto" style="max-height: 23vh; object-fit: contain;" 
                 oncontextmenu="return false;" ondragstart="return false;">
            <img id="option1" class="option-image w-full h-auto" style="max-height: 23vh; object-fit: contain;"
                 oncontextmenu="return false;" ondragstart="return false;">
        </div>
        
        <div class="grid grid-cols-2 gap-4 md:gap-4"
             style="position: absolute; top: 58vh; left: 50%; transform: translateX(-50%); width: 90%; max-width: 800px;">
            <img id="option2" class="option-image w-full h-auto" style="max-height: 23vh; object-fit: contain;"
                 oncontextmenu="return false;" ondragstart="return false;">
            <img id="option3" class="option-image w-full h-auto" style="max-height: 23vh; object-fit: contain;"
                 oncontextmenu="return false;" ondragstart="return false;">
        </div>
        
        <!-- Navigation Buttons -->
        <div id="navigationButtons" class="flex justify-center gap-2 flex-wrap"
             style="position: absolute; top: 82vh; left: 50%; transform: translateX(-50%); max-width: 90%;">
        </div>
        

    </div>

    <!-- Results Page -->
    <div id="resultsPage" class="w-full h-screen hidden p-4 flex flex-col items-center justify-center">
        <div class="text-center mb-4">
            <h1 class="text-4xl md:text-6xl font-black text-blue-800 mb-4">테스트 완료!</h1>
            <div id="scoreDisplay" class="text-2xl md:text-4xl font-bold mb-4"></div>
            <div id="gradeMessage" class="text-xl md:text-2xl mb-4"></div>
        </div>
        
        <div id="detailedResults" class="bg-white bg-opacity-80 rounded-2xl p-4 cute-shadow max-w-5xl w-full mb-6">
            <h3 class="text-xl font-bold text-blue-800 mb-3 text-center">상세 결과</h3>
            <div id="resultsList" class="grid grid-cols-3 md:grid-cols-6 lg:grid-cols-9 gap-2 text-sm justify-items-center"></div>
        </div>
        
        <div class="flex gap-4">
            <button id="playAgainBtn" 
                    class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full cute-shadow hover-scale">
                PLAY AGAIN
            </button>
            <button id="homeFromResultsBtn" 
                    class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-full cute-shadow hover-scale">
                HOME
            </button>
        </div>
    </div>

    <script>
        // Questions data
        const questions = [
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q01.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q01.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q01a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q01b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q01c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q01d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q02.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q02.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q02a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q02b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q02c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q02d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q03.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q03.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q03a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q03b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q03c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q03d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q04.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q04.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q04a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q04b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q04c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q04d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q05.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q05.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q05a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q05b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q05c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q05d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q06.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q06.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q06a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q06b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q06c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q06d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q07.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q07.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q07a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q07b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q07c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q07d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q08.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q08.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q08a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q08b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q08c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q08d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q09.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q09.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q09a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q09b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q09c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q09d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q10.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q10.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q10a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q10b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q10c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q10d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q11.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q11.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q11a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q11b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q11c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q11d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q12.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q12.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q12a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q12b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q12c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q12d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q13.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q13.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q13a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q13b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q13c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q13d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q14.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q14.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q14a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q14b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q14c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q14d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q15.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q15.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q15a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q15b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q15c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q15d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q16.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q16.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q16a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q16b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q16c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q16d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q17.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q17.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q17a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q17b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q17c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q17d.jpg"
                ],
                correct: 0
            },
            {
                audio: "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q18.mp3",
                subtitle: "https://kiyoshichang.github.io/cassette/vtt_topik/Topik1-Listening_Q18.vtt",
                options: [
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q18a.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q18b.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q18c.jpg",
                    "https://mon-ami.up.seesaa.net/topik/Topik1-Listening_Q18d.jpg"
                ],
                correct: 0
            }
        ];

        // Game state
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let correctCount = 0;
        let currentAudio = null;
        let countdownTimer = null;
        let isAnswered = false;
        let subtitlesEnabled = false;
        let currentPlaybackRate = 1;
        let shuffledOptions = [];

        // Audio elements
        const correctSound = new Audio('https://mon-ami.up.seesaa.net/topik/SE_Correct.mp3');
        const wrongSound = new Audio('https://mon-ami.up.seesaa.net/topik/SE_Wrong.mp3');
        const cheerSound = new Audio('https://mon-ami.up.seesaa.net/topik/SE_Cheering.mp3');

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            setupEventListeners();
            document.getElementById('totalQuestions').textContent = questions.length;
            
            // Recalculate center position when window is resized
            window.addEventListener('resize', () => {
                if (document.getElementById('page2').classList.contains('hidden') === false) {
                    setTimeout(calculateCenterPosition, 100);
                }
            });
        });

        function setupEventListeners() {
            // Page navigation
            document.getElementById('startQuiz').addEventListener('click', () => {
                resetQuiz();
                showPage('page2');
                loadQuestion(0);
            });

            document.getElementById('homeBtn').addEventListener('click', () => {
                fadeOutCurrentAudio();
                resetSubtitles();
                showPage('page1');
            });

            document.getElementById('homeFromResultsBtn').addEventListener('click', () => {
                fadeOutCurrentAudio();
                showPage('page1');
            });

            document.getElementById('playAgainBtn').addEventListener('click', () => {
                resetQuiz();
                showPage('page2');
                loadQuestion(0);
            });

            // Audio controls
            document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
            document.getElementById('volumeSlider').addEventListener('input', updateVolume);
            document.getElementById('overflowBtn').addEventListener('click', toggleOverflowMenu);

            // Speed controls
            document.querySelectorAll('.speed-control').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const speed = parseFloat(e.target.dataset.speed);
                    setPlaybackSpeed(speed);
                });
            });

            // Subtitle toggle
            document.getElementById('subtitleToggle').addEventListener('click', toggleSubtitles);
            
            // Close overflow menu button
            document.getElementById('closeOverflowBtn').addEventListener('click', () => {
                document.getElementById('overflowPanel').classList.add('hidden');
            });

            // Option selection
            for (let i = 0; i < 4; i++) {
                document.getElementById(`option${i}`).addEventListener('click', () => selectAnswer(i));
            }

            // Close overflow menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.overflow-menu')) {
                    document.getElementById('overflowPanel').classList.add('hidden');
                }
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('[id^="page"], #resultsPage').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            userAnswers = [];
            correctCount = 0;
            isAnswered = false;
            subtitlesEnabled = false;
            currentPlaybackRate = 1;
            
            // Reset UI
            document.getElementById('correctCount').textContent = '0';
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('feedbackMessage').classList.add('hidden');
            document.getElementById('countdownDisplay').innerHTML = '';
            
            // Reset subtitles
            resetSubtitles();
            
            // Reset navigation buttons
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.className = 'nav-button unanswered';
            });
            
            // Clear confetti
            document.querySelectorAll('.confetti').forEach(el => el.remove());
        }

        function initializeNavigation() {
            const navContainer = document.getElementById('navigationButtons');
            navContainer.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const btn = document.createElement('button');
                btn.className = 'nav-button unanswered';
                btn.textContent = i + 1;
                btn.addEventListener('click', () => loadQuestion(i));
                navContainer.appendChild(btn);
            }
        }

        function loadQuestion(index) {
            if (index < 0 || index >= questions.length) return;
            
            fadeOutCurrentAudio();
            clearTimeout(countdownTimer);
            
            currentQuestionIndex = index;
            isAnswered = false;
            
            // Update UI
            document.getElementById('currentQuestion').textContent = index + 1;
            document.getElementById('feedbackMessage').classList.add('hidden');
            document.getElementById('countdownDisplay').innerHTML = '';
            
            // Update navigation
            document.querySelectorAll('.nav-button').forEach((btn, i) => {
                btn.classList.toggle('current', i === index);
            });
            
            // Shuffle options
            shuffleOptions(index);
            
            // Load audio and subtitles
            loadAudioAndSubtitles(index);
            
            // Calculate and set center position between image rows
            setTimeout(() => {
                calculateCenterPosition();
            }, 100);
            
            // Start countdown before playing
            startPrePlayCountdown();
        }

        function shuffleOptions(questionIndex) {
            const question = questions[questionIndex];
            const indices = [0, 1, 2, 3];
            
            // Fisher-Yates shuffle
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            
            shuffledOptions = indices;
            
            // Update images
            indices.forEach((originalIndex, displayIndex) => {
                const img = document.getElementById(`option${displayIndex}`);
                img.src = question.options[originalIndex];
                img.dataset.originalIndex = originalIndex;
            });
        }

        function loadAudioAndSubtitles(index) {
            const question = questions[index];
            const audio = document.getElementById('audioPlayer');
            const track = audio.querySelector('track');
            
            audio.src = question.audio;
            track.src = question.subtitle;
            
            currentAudio = audio;
            
            // Reset audio controls
            audio.currentTime = 0;
            audio.playbackRate = currentPlaybackRate;
            updateProgressBar();
            
            // Reset subtitles first
            resetSubtitles();
            
            // Load subtitle content for sync
            loadSubtitleContent(question.subtitle);
        }

        let subtitleCues = [];
        let subtitleUpdateInterval = null;

        function loadSubtitleContent(vttUrl) {
            fetch(vttUrl)
                .then(response => response.text())
                .then(vttContent => {
                    subtitleCues = parseVTT(vttContent);
                })
                .catch(console.error);
        }

        function parseVTT(vttContent) {
            const lines = vttContent.split('\n');
            const cues = [];
            let currentCue = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Skip empty lines and WEBVTT header
                if (!line || line === 'WEBVTT') continue;
                
                // Check if line contains timestamp
                if (line.includes('-->')) {
                    const [start, end] = line.split('-->').map(t => parseTimeToSeconds(t.trim()));
                    currentCue = { start, end, korean: '', chinese: '' };
                } else if (currentCue && line) {
                    // Determine if line is Korean or Chinese
                    if (line.includes('한') || line.includes('습') || line.includes('다') || /[ㄱ-ㅎ가-힣]/.test(line)) {
                        currentCue.korean = line;
                    } else if (line.includes('中') || /[\u4e00-\u9fff]/.test(line)) {
                        currentCue.chinese = line;
                    }
                    
                    // If we have both texts or reached next cue, save current cue
                    if ((currentCue.korean && currentCue.chinese) || 
                        (i + 1 < lines.length && lines[i + 1].includes('-->'))) {
                        cues.push(currentCue);
                        currentCue = null;
                    }
                }
            }
            
            return cues;
        }

        function parseTimeToSeconds(timeStr) {
            const parts = timeStr.split(':');
            const seconds = parseFloat(parts[parts.length - 1].replace(',', '.'));
            const minutes = parseInt(parts[parts.length - 2]) || 0;
            const hours = parseInt(parts[parts.length - 3]) || 0;
            return hours * 3600 + minutes * 60 + seconds;
        }

        function calculateCenterPosition() {
            // Wait for images to load and get actual positions
            const topRowImages = document.querySelectorAll('.grid.grid-cols-2:first-of-type img');
            const bottomRowImages = document.querySelectorAll('.grid.grid-cols-2:last-of-type img');
            
            // Check if images are loaded
            let allImagesLoaded = true;
            [...topRowImages, ...bottomRowImages].forEach(img => {
                if (!img.complete || img.naturalHeight === 0) {
                    allImagesLoaded = false;
                }
            });
            
            if (!allImagesLoaded) {
                // Retry after images load
                setTimeout(calculateCenterPosition, 200);
                return;
            }
            
            if (topRowImages.length > 0 && bottomRowImages.length > 0) {
                // Get the actual bottom position of top row images
                let topRowBottom = 0;
                topRowImages.forEach(img => {
                    const rect = img.getBoundingClientRect();
                    topRowBottom = Math.max(topRowBottom, rect.bottom);
                });
                
                // Get the actual top position of bottom row images
                let bottomRowTop = window.innerHeight;
                bottomRowImages.forEach(img => {
                    const rect = img.getBoundingClientRect();
                    bottomRowTop = Math.min(bottomRowTop, rect.top);
                });
                
                // Calculate the exact center point between image rows
                const centerY = (topRowBottom + bottomRowTop) / 2;
                
                // Convert to absolute positioning from top of viewport
                const countdownDisplay = document.getElementById('countdownDisplay');
                const feedbackMessage = document.getElementById('feedbackMessage');
                
                // Use absolute positioning instead of vh
                countdownDisplay.style.position = 'fixed';
                countdownDisplay.style.top = `${centerY}px`;
                countdownDisplay.style.left = '50%';
                countdownDisplay.style.transform = 'translate(-50%, -50%)';
                countdownDisplay.style.zIndex = '1000';
                
                feedbackMessage.style.position = 'fixed';
                feedbackMessage.style.top = `${centerY}px`;
                feedbackMessage.style.left = '50%';
                feedbackMessage.style.transform = 'translate(-50%, -50%)';
                feedbackMessage.style.zIndex = '100';
                
                console.log(`Top row bottom: ${topRowBottom}px, Bottom row top: ${bottomRowTop}px, Center: ${centerY}px`);
            }
        }

        function updateSubtitles() {
            if (!currentAudio || !subtitlesEnabled || subtitleCues.length === 0) return;
            
            const currentTime = currentAudio.currentTime;
            const activeCue = subtitleCues.find(cue => 
                currentTime >= cue.start && currentTime <= cue.end
            );
            
            const subtitleText = document.getElementById('subtitleText');
            
            if (activeCue) {
                subtitleText.innerHTML = `
                    <div class="font-bold text-lg text-blue-800 leading-tight">${activeCue.korean || ''}</div>
                    <div class="text-base text-gray-700 leading-tight" style="margin-top: 2px;">${activeCue.chinese || ''}</div>
                `;
            } else {
                subtitleText.innerHTML = `
                    <div class="font-bold text-lg text-transparent leading-tight">한국어 자막</div>
                    <div class="text-base text-transparent leading-tight" style="margin-top: 2px;">中文字幕</div>
                `;
            }
        }

        function resetSubtitles() {
            const subtitleText = document.getElementById('subtitleText');
            subtitleText.innerHTML = `
                <div class="font-bold text-lg text-transparent leading-tight">한국어 자막</div>
                <div class="text-base text-transparent leading-tight" style="margin-top: 2px;">中文字幕</div>
            `;
            
            if (subtitleUpdateInterval) {
                clearInterval(subtitleUpdateInterval);
                subtitleUpdateInterval = null;
            }
            
            subtitleCues = [];
        }

        function startPrePlayCountdown() {
            let countdown = 5;
            const display = document.getElementById('countdownDisplay');
            
            function updateCountdown() {
                display.innerHTML = `<div class="countdown-number text-gray-500">${countdown}</div>`;
                countdown--;
                
                if (countdown >= 0) {
                    countdownTimer = setTimeout(updateCountdown, 1000);
                } else {
                    display.innerHTML = '';
                    playCurrentAudio();
                }
            }
            
            updateCountdown();
        }

        function playCurrentAudio() {
            if (currentAudio) {
                currentAudio.play().then(() => {
                    updatePlayPauseButton(true);
                    
                    // Start subtitle sync
                    if (subtitleUpdateInterval) {
                        clearInterval(subtitleUpdateInterval);
                    }
                    subtitleUpdateInterval = setInterval(updateSubtitles, 100);
                    
                    currentAudio.addEventListener('ended', () => {
                        updatePlayPauseButton(false);
                        if (subtitleUpdateInterval) {
                            clearInterval(subtitleUpdateInterval);
                            subtitleUpdateInterval = null;
                        }
                        if (!isAnswered) {
                            startPostPlayCountdown();
                        }
                    }, { once: true });
                    
                    currentAudio.addEventListener('timeupdate', updateProgressBar);
                }).catch(console.error);
            }
        }

        function startPostPlayCountdown() {
            let countdown = 20;
            const display = document.getElementById('countdownDisplay');
            
            function updateCountdown() {
                const color = countdown <= 5 ? 'text-red-500' : 'text-blue-500';
                display.innerHTML = `<div class="countdown-number ${color}">${countdown}</div>`;
                countdown--;
                
                if (countdown >= 0 && !isAnswered) {
                    countdownTimer = setTimeout(updateCountdown, 1000);
                } else if (!isAnswered) {
                    display.innerHTML = '';
                    handleTimeout();
                }
            }
            
            updateCountdown();
        }

        function selectAnswer(optionIndex) {
            if (isAnswered) return;
            
            isAnswered = true;
            clearTimeout(countdownTimer);
            fadeOutCurrentAudio();
            
            const selectedImg = document.getElementById(`option${optionIndex}`);
            const originalIndex = parseInt(selectedImg.dataset.originalIndex);
            const isCorrect = originalIndex === questions[currentQuestionIndex].correct;
            
            // Record answer
            userAnswers[currentQuestionIndex] = {
                question: currentQuestionIndex + 1,
                selected: originalIndex,
                correct: isCorrect,
                timeout: false
            };
            
            // Update score
            if (isCorrect) {
                correctCount++;
                document.getElementById('correctCount').textContent = correctCount;
            }
            
            updateScore();
            updateNavigationButton(currentQuestionIndex, isCorrect ? 'correct' : 'wrong');
            showFeedback(isCorrect ? 'correct' : 'wrong');
            
            // Auto advance after 2 seconds
            setTimeout(() => {
                if (currentQuestionIndex < questions.length - 1) {
                    loadQuestion(currentQuestionIndex + 1);
                } else {
                    showResults();
                }
            }, 2000);
        }

        function handleTimeout() {
            if (isAnswered) return;
            
            isAnswered = true;
            
            // Record timeout
            userAnswers[currentQuestionIndex] = {
                question: currentQuestionIndex + 1,
                selected: -1,
                correct: false,
                timeout: true
            };
            
            updateNavigationButton(currentQuestionIndex, 'timeout');
            showFeedback('timeout');
            
            // Auto advance after 2 seconds
            setTimeout(() => {
                if (currentQuestionIndex < questions.length - 1) {
                    loadQuestion(currentQuestionIndex + 1);
                } else {
                    showResults();
                }
            }, 2000);
        }

        function showFeedback(type) {
            const feedbackEl = document.getElementById('feedbackMessage');
            const countdownEl = document.getElementById('countdownDisplay');
            
            let message = '';
            let sound = null;
            
            switch (type) {
                case 'correct':
                    message = '<div class="text-2xl font-bold text-blue-600">정답입니다!</div><div class="text-lg text-blue-500">(Correct Answer!)</div>';
                    sound = correctSound;
                    break;
                case 'wrong':
                    message = '<div class="text-2xl font-bold text-red-600">정답이 아닙니다!</div><div class="text-lg text-red-500">(Wrong Answer!)</div>';
                    sound = wrongSound;
                    break;
                case 'timeout':
                    message = '<div class="text-2xl font-bold text-red-600">타임업입니다!</div><div class="text-lg text-red-500">(Time\'s Up!)</div>';
                    sound = wrongSound;
                    break;
            }
            
            feedbackEl.innerHTML = message;
            feedbackEl.classList.remove('hidden');
            countdownEl.innerHTML = '';
            
            if (sound) {
                sound.play().catch(console.error);
            }
        }

        function updateScore() {
            const pointsPerQuestion = 100 / questions.length;
            const score = Math.round(correctCount * pointsPerQuestion);
            document.getElementById('currentScore').textContent = score;
        }

        function updateNavigationButton(index, status) {
            const btn = document.querySelectorAll('.nav-button')[index];
            btn.className = `nav-button ${status}`;
        }

        function showResults() {
            fadeOutCurrentAudio();
            
            const pointsPerQuestion = 100 / questions.length;
            const finalScore = Math.round(correctCount * pointsPerQuestion);
            
            // Update score display
            document.getElementById('scoreDisplay').innerHTML = `
                <div class="text-blue-600">최종 점수: ${finalScore}점</div>
                <div class="text-green-600">정답: ${correctCount}/${questions.length}</div>
            `;
            
            // Grade message
            let gradeMessage = '';
            if (finalScore >= 80) {
                gradeMessage = '<div class="text-2xl font-bold text-green-600">훌륭합니다!</div><div class="text-lg text-green-500">(Excellent!)</div>';
                createConfetti();
                cheerSound.play().catch(console.error);
            } else if (finalScore >= 60) {
                gradeMessage = '<div class="text-2xl font-bold text-blue-600">잘했습니다!</div><div class="text-lg text-blue-500">(Good Job!)</div>';
            } else {
                gradeMessage = '<div class="text-2xl font-bold text-orange-600">더 열심히 공부하세요!</div><div class="text-lg text-orange-500">(Keep Studying!)</div>';
            }
            
            document.getElementById('gradeMessage').innerHTML = gradeMessage;
            
            // Detailed results
            showDetailedResults();
            
            // Send results via email
            sendResultToEmail();
            
            showPage('resultsPage');
        }

        function showDetailedResults() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            for (let i = 0; i < questions.length; i++) {
                const answer = userAnswers[i];
                let status = '';
                let statusClass = '';
                
                if (!answer) {
                    status = '미응답 (Not Answered)';
                    statusClass = 'text-gray-600';
                } else if (answer.timeout) {
                    status = '시간 초과 (Time\'s Up)';
                    statusClass = 'text-purple-600';
                } else if (answer.correct) {
                    status = '정답 (Correct)';
                    statusClass = 'text-green-600';
                } else {
                    status = '오답 (Wrong)';
                    statusClass = 'text-red-600';
                }
                
                const resultItem = document.createElement('div');
                resultItem.className = `p-2 bg-white rounded-lg text-center ${statusClass}`;
                resultItem.innerHTML = `
                    <div class="font-bold">Q${i + 1}</div>
                    <div class="text-xs">${status}</div>
                `;
                resultsList.appendChild(resultItem);
            }
        }

        function sendResultToEmail() {
            const emailAddress = '13756023@scu.edu.tw';
            const subject = 'TOPIK I Listening Test Result';
            const pointsPerQuestion = 100 / questions.length;
            const finalScore = Math.round(correctCount * pointsPerQuestion);
            
            let body = `TOPIK I Listening Test Result:\n\n`;
            body += `Total Score: ${finalScore} Points\n`;
            body += `Correct Answers: ${correctCount} / ${questions.length}\n\n`;
            
            body += `Answering Details:\n`;
            for (let i = 0; i < questions.length; i++) {
                const answer = userAnswers[i];
                if (!answer) {
                    body += `Q ${i + 1}: Not Answered\n`;
                } else if (answer.timeout) {
                    body += `Q ${i + 1}: Time's Up\n`;
                } else {
                    body += `Q ${i + 1}: ${answer.correct ? '○' : '×'}\n`;
                }
            }
            
            try {
                const mailtoLink = `mailto:${emailAddress}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.open(mailtoLink, '_blank');
            } catch (e) {
                console.error('Failed to send email:', e);
            }
        }

        function createConfetti() {
            const colors = ['#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#2ecc71'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 100);
            }
        }

        function fadeOutCurrentAudio() {
            if (currentAudio && !currentAudio.paused) {
                const fadeAudio = currentAudio;
                const originalVolume = fadeAudio.volume;
                const fadeInterval = setInterval(() => {
                    if (fadeAudio.volume > 0.1) {
                        fadeAudio.volume -= 0.1;
                    } else {
                        fadeAudio.pause();
                        fadeAudio.volume = originalVolume;
                        clearInterval(fadeInterval);
                    }
                }, 100);
            }
            
            // Stop subtitle sync
            if (subtitleUpdateInterval) {
                clearInterval(subtitleUpdateInterval);
                subtitleUpdateInterval = null;
            }
        }

        // Audio control functions
        function togglePlayPause() {
            if (currentAudio) {
                if (currentAudio.paused) {
                    currentAudio.play();
                } else {
                    currentAudio.pause();
                }
                updatePlayPauseButton(!currentAudio.paused);
            }
        }

        function updatePlayPauseButton(isPlaying) {
            const playIcon = document.getElementById('playIcon');
            const pauseIcon = document.getElementById('pauseIcon');
            
            if (isPlaying) {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        }

        function updateVolume() {
            const volume = document.getElementById('volumeSlider').value / 100;
            if (currentAudio) {
                currentAudio.volume = volume;
            }
        }

        function updateProgressBar() {
            if (currentAudio) {
                const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
                
                document.getElementById('currentTime').textContent = formatTime(currentAudio.currentTime);
                document.getElementById('totalTime').textContent = formatTime(currentAudio.duration);
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function toggleOverflowMenu() {
            const panel = document.getElementById('overflowPanel');
            panel.classList.toggle('hidden');
        }

        function setPlaybackSpeed(speed) {
            const btn = event.target;
            const isCurrentlyActive = btn.classList.contains('active');
            
            if (isCurrentlyActive) {
                // Turn off this speed, revert to normal
                btn.classList.remove('active');
                currentPlaybackRate = 1;
            } else {
                // Turn off all other speeds and activate this one
                document.querySelectorAll('.speed-control').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentPlaybackRate = speed;
            }
            
            if (currentAudio) {
                currentAudio.playbackRate = currentPlaybackRate;
            }
        }

        function toggleSubtitles() {
            subtitlesEnabled = !subtitlesEnabled;
            const toggle = document.getElementById('subtitleToggle');
            
            toggle.classList.toggle('active', subtitlesEnabled);
            
            if (!subtitlesEnabled) {
                resetSubtitles();
            }
        }

        // Add cursor pointer styles
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                button, .option-image, .nav-button {
                    cursor: pointer !important;
                }
                button:hover, .option-image:hover, .nav-button:hover {
                    cursor: pointer !important;
                }
                
                @media (max-width: 768px) {
                    .nav-button {
                        width: 35px;
                        height: 35px;
                        font-size: 12px;
                    }
                    
                    .grid.grid-cols-2 {
                        gap: 8px !important;
                    }
                    
                    .option-image {
                        max-height: 20vh !important;
                    }
                    
                    #navigationButtons {
                        top: 72vh !important;
                        gap: 4px !important;
                    }
                    
                    .subtitle-box {
                        padding: 2px 8px !important;
                        min-height: 30px !important;
                    }
                    
                    /* 手機版圖片位置調整 */                    
.grid.grid-cols-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem; /* 控制上下左右的距離 */
}
                }
            `;
            document.head.appendChild(style);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97cdca97d1dcb2fe',t:'MTc1NzQ5NTQxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>